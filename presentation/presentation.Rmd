---
title: "Factors affecting frequency of Volcanic eruptions"
subtitle: "Presentation subtitle (if any)"
author: "x404-pagenotfound <br> Emma, Bridget, Sachin"
institute: "University of Edinburgh"
date: "4 December 2020"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---


```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(tidyverse)
library(broom)
library(janitor)
library(glue)
library(choroplethr)
library(choroplethrMaps)
library(leaflet)

```

```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%")
```

```{r load-data, include=FALSE}
# Load your data here
setwd("/cloud/project/proposal")
volcano <- read_csv("../data/volcano.csv")
eruptions <- read_csv("../data/eruptions.csv")
events <- read_csv("../data/events.csv")
```

```{r data-for-map, include=FALSE}
#Join eruptions and volcano to match each eruption to its corresponding volcano
volcanic_eruption <- left_join(volcano, eruptions, by="volcano_number")
#load df with list of countries
data("country.regions")
#create CountVolc which stores number of eruptions for each country
CountVolc = group_by(volcanic_eruption, country) %>% summarise(value = n())
CountVolc = as.data.frame(CountVolc)
CountVolc[,1] = tolower(CountVolc[,1])
rownames(CountVolc) = CountVolc$country

#some eruptions are on the border between two countries, so we split that count between each country
CountVolc["chile","value"] = CountVolc["chile","value"] + CountVolc["chile-argentina","value"]/2
CountVolc["argentina","value"] = CountVolc["argentina","value"] + CountVolc["chile-argentina","value"]/2

#some country names must be changed to get the count
CountVolc$country=gsub("united states", "united states of america", CountVolc$country)

#Aggregating the counts into unique country names
CountVolcUni <- group_by(CountVolc, country) %>%
  summarise(value = sum(value))
CountVolcUni = as.data.frame(CountVolcUni)
rownames(CountVolcUni) = CountVolcUni$country

```

class: center, middle

## A statement of the overall goal / research question

---

class: inverse, center, middle

# Volcano Dataset

---


background-image: url(https://camo.githubusercontent.com/4295e3eef5545f83277639df7e7b73fa7de3bc5722c0da60d5ff44b6e1f3df8d/68747470733a2f2f75706c6f61642e77696b696d656469612e6f72672f77696b6970656469612f636f6d6d6f6e732f7468756d622f332f33342f4572757063692543332542336e5f656e5f656c5f766f6c632543332541316e5f536162616e636179612532435f5065722543332542412e6a70672f3132383070782d4572757063692543332542336e5f656e5f656c5f766f6c632543332541316e5f536162616e636179612532435f5065722543332542412e6a7067)

---
# World Map showing Number of Volcanic Eruptions

```{r World-Map, echo=FALSE}
#create tibble with rownames as countries
CountVolcFake = country.regions
CountVolcFake$value = 0
rownames(CountVolcFake) = CountVolcFake$region
#choose the countries in both tibbles
ii=intersect(CountVolcUni$country,country.regions$region)
CountVolcFake[ii, "value"] = (CountVolcUni[ii, "value"])
#create choropleth map with palette
country_choropleth(CountVolcFake, num_colors = 9) +
scale_fill_brewer(palette="YlOrRd") +
labs(title = "Number of Volcanic Eruptions by Country")




#find countries that arent included
MissingCountries = CountVolcUni$country[!CountVolcUni$country %in% country.regions$region]
```


---

```{r, echo=FALSE}
set.seed(1)
ran_rows <- sample(nrow(volcanic_eruption), 1000)
leaflet(data = volcanic_eruption) %>% 
  addTiles() %>%
  addMarkers(~longitude.x, ~latitude.x, popup = ~as.character(volcano_name.x), label = ~as.character(volcano_name.x), clusterOptions = markerClusterOptions())
```

---

```{r, echo=FALSE}
leaflet(volcanic_eruption) %>% 
  addTiles() %>%
  addCircleMarkers(
    ~longitude.x, ~latitude.x,
    radius = 3,
    color = "red",
    stroke = FALSE, fillOpacity = 0.4
  )
```


--- 

# Map eruptions as data points compared with tectonic plates

---

# Map eruptions by tectonic plate type

```{r seperate-techtonics, echo=FALSE}
volcano_tecs <- volcano%>%
  #filter out Vitim Volcanic Field volcano as tec settings are unknown
  filter(tectonic_settings != "Unknown")%>%
  #seperate the tec setting from the crust 
  separate(tectonic_settings, c("techtonic_setting", "crust"),
                    sep = "([/])")
  
```

```{r eruption-frequency, echo=FALSE}
eruption_tecs<- left_join(volcano_tecs, eruptions,
                          by=c("volcano_number", "volcano_name",
                               "latitude", "longitude"))
  
eruption_tecs_fqncy <- eruption_tecs%>%
  count(volcano_number, volcano_name, techtonic_setting, crust) %>% 
  mutate(frequency = as.factor(n))%>%
  #str_trim("crust", side = "left")%>%
  #ideally remove whitespace for easier use but leave for later
  filter(crust != " Crustal thickness unknown")
  

  
```

```{r tec-map, echo = FALSE}
tec_pal<- colorFactor(
  palette = c("#a50026", "#313695", "#4d9221"),
  domain = eruption_tecs$techtonic_setting
)
#red=intraplate
#blue=riftzone
#green=subductionzone


leaflet(eruption_tecs) %>% 
  addTiles() %>%
  addCircleMarkers(
    ~longitude, ~latitude,
    radius = 3,
    color = ~tec_pal(techtonic_setting),
    stroke = FALSE, 
    fillOpacity = 0.4
  )
```
---

# Map of Crust type

```{r crust-map, echo=FALSE}
crust_pal<- colorFactor(
  palette = c("#d73027", "#762a83", "#fee090", "#4575b4"),
  domain = eruption_tecs$crust
)
#red=continental
#yellow=intermediate
#blue=oceanic
#purple=unknown


leaflet(eruption_tecs) %>% 
  addTiles() %>%
  addCircleMarkers(
    ~longitude, ~latitude,
    radius = 3,
    color = ~crust_pal(crust),
    stroke = FALSE, 
    fillOpacity = 0.4
  )
```
---

# Model frequency by tectonic plate type
---
# Model frequency by crust type
---
# Bar chart frequency by country by volcano type

```{r eruptions-by-country-and-volcano-type, echo=FALSE}

volcanic_eruption %>%
  group_by(country, primary_volcano_type) %>%
   mutate( freq_eruptions=n(),
          primary_volcano_type=if_else(primary_volcano_type=="Stratovolcano(es)", "Stratovolcano", primary_volcano_type) ) %>%
  arrange(desc(freq_eruptions)) %>%
  distinct(country, primary_volcano_type, freq_eruptions) %>%
  head(25)%>%
  ggplot(aes(x=country,y=freq_eruptions)) +
  geom_col(aes(fill=primary_volcano_type)) +
  coord_flip() +
  labs(x="Country",y="Number of Eruptions", title="Frequency of Eruptions by Country", subtitle="and Vocano Type", fill="Primary Volcano Type") +
  scale_fill_brewer(palette="YlOrRd")


```
---
# Bar chart frequency by volcano type

```{r eruptions-by-volcano-type, echo=FALSE}

volcanic_eruption %>%
  group_by(primary_volcano_type) %>%
  mutate( freq_eruptions=n(),
          primary_volcano_type=if_else(primary_volcano_type=="Stratovolcano(es)", "Stratovolcano", primary_volcano_type) ) %>%
  arrange(desc(freq_eruptions)) %>%
  distinct(primary_volcano_type, freq_eruptions) %>%
  head(10)%>%
  ggplot(aes(x=fct_rev(as.factor(primary_volcano_type)),y=freq_eruptions,fill=primary_volcano_type)) +
  geom_col() +
  coord_flip() +
  labs(x="Primary Volcano Type",y="Number of Eruptions", title="Frequency of Eruptions by Vocano Type") +
  scale_fill_brewer(palette="YlOrRd")

```
---
```{r count-volcanoes-by-volcano-type, echo=FALSE}

volcano %>%
  group_by(primary_volcano_type) %>%
  mutate( primary_volcano_type=case_when(
    primary_volcano_type=="Stratovolcano(es)"~"Stratovolcano",
    primary_volcano_type=="Shield(s)"~"Shield",
    primary_volcano_type=="Pyroclastic cone(s)"~"Pyroclastic cone",
    TRUE ~ primary_volcano_type
    )) %>%
  ggplot(aes(x=fct_rev(as.factor(primary_volcano_type)),fill=primary_volcano_type)) +
  geom_bar() +
  coord_flip() +
  labs(x="Primary Volcano Type",y="Count", title="Number of Volcanoes by Vocano Type")

```

---
# Short Comings
-A lot of NAs in the event table around dates, due to some ancient volcanic eruptions being recorded
-Also several eruptions are ongoing in the world, therefore finish date not recorded
- Therefore we could not investigate what factors affect the length of eruptions like we had initially proposed, which lead us to writing a re-proposal. 
---
# Conclusion
We believe the factors which affect volcanic eruptions according to our investigation are : 
-Location of volcano (position on tectonic plate)
-Tectonic Plate Setting
-Tectonic Plate Type
-Crust Type
-Primary Volcano Type

We also hypothesize that there may be a relationship between these factors, based on our findings.
---
#Future research/Investigation
- Investigate the relationship between the factors which affect the volcanic eruptions - cause them to arise, how frequently they arise etc